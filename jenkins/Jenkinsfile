pipeline {
  agent any

  environment {
    DEV_REPO_URL = "https://github.com/RaniSaed/smart-retail-dev.git"
    CONFIG_REPO_URL = "https://github.com/RaniSaed/smart-retail-config.git"
  }

  stages {
    stage('📥 Clone Repositories') {
      steps {
        echo '🔄 Cloning smart-retail-dev and smart-retail-config...'

        dir('dev') {
          git url: "${DEV_REPO_URL}", branch: 'main'
        }

        dir('config') {
          git url: "${CONFIG_REPO_URL}", branch: 'main'
        }
      }
    }

    stage('🔍 Lint & Test Code') {
      steps {
        script {
          echo '🧪 Running flake8 for backend...'
          dir('dev/backend') {
            sh 'flake8 app.py || true'
          }

          echo '🧪 Running eslint for frontend...'
          dir('dev/frontend') {
            sh 'npm install'
            sh 'npx eslint src --ext .ts,.tsx || true'
          }

          echo '✅ Linting done (errors ignored for now)'
        }
      }
    }
  }

  post {
    success {
      echo "✅ Pipeline stage 2 finished successfully!"
    }
    failure {
      echo "❌ Linting or cloning failed."
    }
  }
}
